<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todos</title>
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 48px 16px;
    }

    .app {
      width: 100%;
      max-width: 520px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.06);
      padding: 28px 24px 20px;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 24px;
    }

    .header svg {
      width: 28px;
      height: 28px;
      color: #5b6abf;
      flex-shrink: 0;
    }

    .header h1 {
      font-size: 26px;
      font-weight: 700;
      color: #222;
      letter-spacing: -0.5px;
    }

    /* Input group */
    .input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .input-group input {
      flex: 1;
      padding: 10px 14px;
      font-size: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.2s;
      font-family: inherit;
    }

    .input-group input:focus {
      border-color: #5b6abf;
    }

    .input-group input::placeholder {
      color: #aaa;
    }

    .btn-add {
      padding: 10px 18px;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      background: #5b6abf;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      white-space: nowrap;
      font-family: inherit;
    }

    .btn-add:hover {
      background: #4a59a8;
    }

    .btn-add:active {
      transform: scale(0.97);
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 6px;
      margin-bottom: 16px;
    }

    .filter-btn {
      padding: 6px 14px;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      font-family: inherit;
    }

    .filter-btn:hover {
      background: #e4e4e4;
    }

    .filter-btn.active {
      background: #5b6abf;
      color: #fff;
    }

    /* Todo list */
    .todo-list {
      list-style: none;
      margin-bottom: 16px;
    }

    .todo-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 4px;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.15s;
    }

    .todo-item:last-child {
      border-bottom: none;
    }

    .todo-item:hover {
      background: #fafafa;
    }

    .todo-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #5b6abf;
      cursor: pointer;
      flex-shrink: 0;
    }

    .todo-text {
      flex: 1;
      font-size: 15px;
      line-height: 1.4;
      word-break: break-word;
      transition: color 0.2s;
    }

    .todo-item.completed .todo-text {
      text-decoration: line-through;
      color: #b0b0b0;
    }

    .btn-delete {
      width: 28px;
      height: 28px;
      font-size: 18px;
      line-height: 28px;
      text-align: center;
      color: #ccc;
      background: none;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
      flex-shrink: 0;
      font-family: inherit;
    }

    .btn-delete:hover {
      color: #e74c3c;
      background: #fdf0ef;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 32px 16px;
      color: #b0b0b0;
      font-size: 14px;
    }

    .empty-state svg {
      width: 40px;
      height: 40px;
      margin-bottom: 8px;
      color: #d5d5d5;
    }

    /* Status bar */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
      font-size: 13px;
      color: #999;
    }

    .btn-clear {
      font-size: 13px;
      color: #999;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: color 0.2s, background 0.2s;
      font-family: inherit;
    }

    .btn-clear:hover {
      color: #e74c3c;
      background: #fdf0ef;
    }

    .btn-clear.hidden {
      visibility: hidden;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        <h1>todos</h1>
      </div>

      <div class="input-group">
        <input type="text" id="todo-input" placeholder="What needs to be done?" autocomplete="off">
        <button class="btn-add" id="btn-add">Add</button>
      </div>

      <div class="filters" id="filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="active">Active</button>
        <button class="filter-btn" data-filter="completed">Completed</button>
      </div>

      <ul class="todo-list" id="todo-list"></ul>

      <div class="status-bar">
        <span id="items-left">0 items left</span>
        <button class="btn-clear hidden" id="btn-clear">Clear Completed</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      "use strict";

      const STORAGE_KEY = "todos_app_data";
      const FILTER_KEY = "todo-filter";

      let todos = [];
      let filter = "all";

      // DOM refs (cached on DOMContentLoaded)
      let $input, $btnAdd, $filters, $list, $itemsLeft, $btnClear;

      // ---- Persistence ----

      function loadTodos() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed)) {
              todos = parsed;
              return;
            }
          }
        } catch (_) {
          // storage unavailable or corrupted — start fresh
        }
        todos = [];
      }

      function saveTodos() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
        } catch (_) {
          // storage full or unavailable — silent fail
        }
      }

      // ---- Actions ----

      function addTodo(text) {
        const trimmed = text.trim();
        if (!trimmed) return;
        todos.push({ id: Date.now().toString(36) + Math.random().toString(36).slice(2), text: trimmed, completed: false });
        saveTodos();
        render();
      }

      function toggleTodo(id) {
        const todo = todos.find(function (t) { return t.id === id; });
        if (todo) {
          todo.completed = !todo.completed;
          saveTodos();
          render();
        }
      }

      function deleteTodo(id) {
        todos = todos.filter(function (t) { return t.id !== id; });
        saveTodos();
        render();
      }

      function clearCompleted() {
        todos = todos.filter(function (t) { return !t.completed; });
        saveTodos();
        render();
      }

      function setFilter(newFilter) {
        filter = newFilter;
        try { localStorage.setItem(FILTER_KEY, filter); } catch (_) {}
        render();
      }

      function loadFilter() {
        try {
          var saved = localStorage.getItem(FILTER_KEY);
          if (saved === "all" || saved === "active" || saved === "completed") {
            filter = saved;
          }
        } catch (_) {}
      }

      function getFilteredTodos() {
        if (filter === "active") return todos.filter(function (t) { return !t.completed; });
        if (filter === "completed") return todos.filter(function (t) { return t.completed; });
        return todos;
      }

      // ---- Render ----

      function render() {
        var filtered = getFilteredTodos();

        // Build list
        $list.innerHTML = "";

        if (filtered.length === 0) {
          var empty = document.createElement("li");
          empty.className = "empty-state";

          var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          svg.setAttribute("viewBox", "0 0 24 24");
          svg.setAttribute("fill", "none");
          svg.setAttribute("stroke", "currentColor");
          svg.setAttribute("stroke-width", "1.5");
          svg.setAttribute("stroke-linecap", "round");
          svg.setAttribute("stroke-linejoin", "round");
          var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          circle.setAttribute("cx", "12");
          circle.setAttribute("cy", "12");
          circle.setAttribute("r", "10");
          var line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
          line1.setAttribute("x1", "8");
          line1.setAttribute("y1", "12");
          line1.setAttribute("x2", "16");
          line1.setAttribute("y2", "12");
          svg.appendChild(circle);
          svg.appendChild(line1);
          empty.appendChild(svg);

          var msg = document.createElement("div");
          if (filter === "active") msg.textContent = "No active todos";
          else if (filter === "completed") msg.textContent = "No completed todos";
          else msg.textContent = "Nothing to do — add a task!";
          empty.appendChild(msg);
          $list.appendChild(empty);
        } else {
          filtered.forEach(function (todo) {
            var li = document.createElement("li");
            li.className = "todo-item" + (todo.completed ? " completed" : "");

            var cb = document.createElement("input");
            cb.type = "checkbox";
            cb.checked = todo.completed;
            cb.setAttribute("data-id", todo.id);

            var span = document.createElement("span");
            span.className = "todo-text";
            span.textContent = todo.text;

            var del = document.createElement("button");
            del.className = "btn-delete";
            del.setAttribute("data-id", todo.id);
            del.textContent = "\u00d7";
            del.title = "Delete";
            del.setAttribute("aria-label", "Delete");

            li.appendChild(cb);
            li.appendChild(span);
            li.appendChild(del);
            $list.appendChild(li);
          });
        }

        // Items left
        var activeCount = todos.filter(function (t) { return !t.completed; }).length;
        $itemsLeft.textContent = activeCount + (activeCount === 1 ? " item left" : " items left");

        // Clear completed visibility
        var hasCompleted = todos.some(function (t) { return t.completed; });
        $btnClear.classList.toggle("hidden", !hasCompleted);

        // Filter buttons
        var btns = $filters.querySelectorAll(".filter-btn");
        btns.forEach(function (btn) {
          btn.classList.toggle("active", btn.getAttribute("data-filter") === filter);
        });
      }

      // ---- Init ----

      document.addEventListener("DOMContentLoaded", function () {
        $input = document.getElementById("todo-input");
        $btnAdd = document.getElementById("btn-add");
        $filters = document.getElementById("filters");
        $list = document.getElementById("todo-list");
        $itemsLeft = document.getElementById("items-left");
        $btnClear = document.getElementById("btn-clear");

        loadTodos();
        loadFilter();

        // Add todo
        $btnAdd.addEventListener("click", function () {
          addTodo($input.value);
          $input.value = "";
          $input.focus();
        });

        $input.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            addTodo($input.value);
            $input.value = "";
          }
        });

        // Event delegation on list
        $list.addEventListener("click", function (e) {
          var target = e.target;
          var id = target.getAttribute("data-id");
          if (!id) return;

          if (target.type === "checkbox") {
            toggleTodo(id);
          } else if (target.classList.contains("btn-delete")) {
            deleteTodo(id);
          }
        });

        // Filters
        $filters.addEventListener("click", function (e) {
          var f = e.target.getAttribute("data-filter");
          if (f) setFilter(f);
        });

        // Clear completed
        $btnClear.addEventListener("click", clearCompleted);

        render();
      });
    })();
  </script>
</body>
</html>
